<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/assets/logo.svg" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="/styles/main.css" />
    <link rel="stylesheet" href="/styles/settings.css" />
    <title>MindHive ¬∑ Settings</title>
  </head>
  <body>
    <%- include('partials/sidebar', { page: 'settings' }) %>

    <div class="settings-container">
      <h1>Settings</h1>

      <% 
        const hasUser = typeof user !== 'undefined' && user;
        const firstName = hasUser && user.first_name ? user.first_name : 'Student';
        const lastName = hasUser && user.last_name ? (' ' + user.last_name) : '';
        const handle =
          hasUser && user.username
            ? user.username
            : hasUser && user.email
            ? user.email.split('@')[0]
            : 'username';
      %>

      <!-- PROFILE CARD -->
      <section class="profile-card">
        <div class="profile-left">
          <div class="profile-avatar">
            <span>
              <%= firstName.charAt(0).toUpperCase() %><%=
                lastName.trim() ? lastName.trim().charAt(0).toUpperCase() : ''
              %>
            </span>
          </div>

          <div class="profile-main">
            <h2 class="profile-name"><%= firstName + lastName %></h2>
            <p class="profile-handle">@<%= handle %></p>
          </div>
        </div>

        <div class="profile-right">
          <div class="profile-stat">
            <span class="stat-label">Rank</span>
            <span class="stat-value" id="profile-rank">Newbie üê£</span>
          </div>

          <div class="profile-stat">
            <span class="stat-label">Position</span>
            <span class="stat-value" id="profile-position">#‚Äî</span>
          </div>

          <div class="profile-stat">
            <span class="stat-label">Student Score</span>
            <span class="stat-value" id="profile-score">0 pts</span>
          </div>

          <button
            type="button"
            class="edit-profile-btn"
            id="edit-profile-btn"
          >
            <i class="fa-solid fa-pen"></i>
            Edit Profile
          </button>
        </div>
      </section>

      <!-- SETTINGS LIST -->
      <form id="settings-form" class="settings-form">
        <div class="form-group">
          <ul>
            <li>
              <button
                type="button"
                class="settings-button"
                id="change-password"
              >
                <h3>Change Password</h3>
              </button>
            </li>
            <li>
              <button type="button" class="settings-button" id="log-out">
                <h3>Log Out</h3>
              </button>
            </li>
            <li>
              <button type="button" class="settings-button" id="red-btn">
                <h3>Delete Account</h3>
              </button>
            </li>
          </ul>
        </div>
      </form>

      <footer class="settings-footer">
        <p>&copy; 2025 MindHive. All rights reserved. <a href="https://mindhive.dev"><i>View Documentation</i></a></p>
      </footer>

      <!-- Password Change Modal -->
      <div id="password-modal" class="password-modal hidden">
        <div class="modal-content">
          <h2>Change Password</h2>

          <input
            type="password"
            id="current_password"
            placeholder="Current Password"
            class="modal-input"
          />

          <input
            type="password"
            id="new_password"
            placeholder="New Password"
            class="modal-input"
          />

          <button id="submit-password" class="confirm-btn">
            Update Password
          </button>
          <button id="cancel-modal" class="cancel-btn">Cancel</button>
        </div>
      </div>
    </div>

    <script src="/js/settings.js"></script>
  </body>
</html>